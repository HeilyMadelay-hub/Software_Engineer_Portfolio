@using Business_School.Models
@{
    ViewData["Title"] = "Dashboard de Estudiante";
 var clubs = (System.Collections.Generic.List<Club>)ViewData["Clubs"];
    var recommended = (System.Collections.Generic.List<Club>)ViewData["Recommended"];
    var progress = (GamificationProgress)ViewData["Progress"];
    var upcoming = (System.Collections.Generic.List<Event>)ViewData["Upcoming"];
}

<div class="container mt-4">
    <!-- Header con título y botón de cerrar sesión -->
 <div class="row mb-4">
 <div class="col-md-6">
     <h2>
        <i class="bi bi-speedometer2"></i> Dashboard de Estudiante
        </h2>
        </div>
    <div class="col-md-6 text-end">
     <!-- Navegación rápida -->
  <a asp-controller="Clubs" asp-action="Index" class="btn btn-outline-primary me-2">
     <i class="bi bi-people"></i> Ver Todos los Clubs
    </a>
       <a asp-controller="Events" asp-action="Index" class="btn btn-outline-info me-2">
<i class="bi bi-calendar-event"></i> Ver Eventos
            </a>
            
<!-- Logout Button -->
<form asp-area="" asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
      <button type="submit" class="btn btn-danger">
         <i class="bi bi-box-arrow-right"></i> Cerrar sesión
          </button>
 </form>
     </div>
    </div>

    <!-- Alerts -->
  @if (TempData["Success"] != null)
    {
   <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle"></i> @TempData["Success"]
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  }
    @if (TempData["Error"] != null)
    {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
         <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
   </div>
    }

    <!-- Progreso de Gamificación -->
  <div class="row mb-4">
   <div class="col-12">
    <div class="card shadow-sm border-0">
   <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
   <h4 class="mb-0">
      <i class="bi bi-trophy"></i> Mi Progreso
   </h4>
        </div>
   <div class="card-body">
   @if (progress != null)
    {
<div class="row text-center">
   <div class="col-md-4 mb-3">
          <div class="p-3 border rounded bg-light">
          <i class="bi bi-star-fill text-warning" style="font-size: 2rem;"></i>
    <h3 class="mt-2 mb-0">@progress.Points</h3>
    <p class="text-muted mb-0">Puntos</p>
    </div>
        </div>
     <div class="col-md-4 mb-3">
       <div class="p-3 border rounded bg-light">
          <i class="bi bi-award-fill text-primary" style="font-size: 2rem;"></i>
           <h3 class="mt-2 mb-0">@progress.Level</h3>
      <p class="text-muted mb-0">Nivel</p>
               </div>
 </div>
<div class="col-md-4 mb-3">
<div class="p-3 border rounded bg-light">
        <i class="bi bi-trophy-fill text-success" style="font-size: 2rem;"></i>
        <h3 class="mt-2 mb-0">@progress.Achievements.Count</h3>
       <p class="text-muted mb-0">Logros</p>
    </div>
     </div>
 </div>

  @if (progress.Achievements.Any())
       {
 <hr />
      <h5 class="mb-3"><i class="bi bi-trophy"></i> Logros Desbloqueados</h5>
     <div class="row">
     @foreach (var achievement in progress.Achievements)
    {
     <div class="col-md-6 mb-2">
  <div class="d-flex align-items-center p-2 bg-light rounded">
        <i class="bi bi-check-circle-fill text-success me-2"></i>
      <span>@achievement</span>
 </div>
       </div>
      }
        </div>
     }
          }
else
  {
         <p class="text-muted mb-0"><i class="bi bi-info-circle"></i> No hay información de progreso disponible.</p>
        }
            </div>
       </div>
        </div>
    </div>

    <!-- Mis Clubs y Clubs Recomendados -->
    <div class="row mb-4">
        <!-- Mis Clubs -->
        <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
       <div class="card-header bg-dark text-white">
     <h4 class="mb-0">
     <i class="bi bi-people-fill"></i> Mis Clubs
       </h4>
     </div>
     <div class="card-body">
   @if (clubs != null && clubs.Count > 0)
       {
    <div class="list-group">
          @foreach (var club in clubs)
       {
  <div class="list-group-item d-flex justify-content-between align-items-center">
     <div>
    <h6 class="mb-1">@club.Name</h6>
          <small class="text-muted">
    <i class="bi bi-building"></i> @club.Department?.Name
        </small>
  </div>
            <div class="btn-group">
         <a asp-controller="Clubs" asp-action="Details" asp-route-id="@club.Id" 
         class="btn btn-sm btn-outline-primary">
           <i class="bi bi-eye"></i> Ver
 </a>
            </div>
  </div>
           }
    </div>
         }
    else
   {
          <div class="alert alert-info mb-0">
           <i class="bi bi-info-circle"></i> No perteneces a ningún club todavía.
  <a asp-controller="Clubs" asp-action="Index" class="alert-link">Explorar clubs</a>
     </div>
      }
    </div>
 @if (clubs != null && clubs.Count > 0)
    {
  <div class="card-footer bg-light">
     <a asp-controller="Clubs" asp-action="MyClubs" class="btn btn-sm btn-outline-dark w-100">
         <i class="bi bi-list"></i> Ver Todos Mis Clubs
   </a>
       </div>
 }
   </div>
      </div>

        <!-- Clubs Recomendados -->
<div class="col-lg-6 mb-4">
<div class="card shadow-sm h-100">
   <div class="card-header bg-info text-white">
  <h4 class="mb-0">
  <i class="bi bi-lightbulb"></i> Clubs Recomendados
       </h4>
    </div>
  <div class="card-body">
@if (recommended != null && recommended.Count > 0)
          {
   <div class="list-group">
@foreach (var club in recommended.Take(5))
         {
     <div class="list-group-item">
    <div class="d-flex justify-content-between align-items-start">
     <div class="flex-grow-1">
            <h6 class="mb-1">@club.Name</h6>
     <small class="text-muted">
        <i class="bi bi-building"></i> @club.Department?.Name
    </small>
      </div>
              <a asp-controller="Clubs" asp-action="Details" asp-route-id="@club.Id" 
            class="btn btn-sm btn-outline-info">
           <i class="bi bi-eye"></i> Ver
 </a>
 </div>
     </div>
       }
            </div>
         }
      else
   {
  <div class="alert alert-warning mb-0">
       <i class="bi bi-exclamation-circle"></i> Basado en tu actividad, no tenemos recomendaciones en este momento.
      </div>
    }
       </div>
     @if (recommended != null && recommended.Count > 0)
             {
  <div class="card-footer bg-light">
 <a asp-controller="Clubs" asp-action="Index" class="btn btn-sm btn-outline-info w-100">
       <i class="bi bi-search"></i> Explorar Más Clubs
</a>
   </div>
       }
    </div>
      </div>
    </div>

    <!-- Próximos Eventos -->
    <div class="row">
    <div class="col-12">
  <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
    <h4 class="mb-0">
<i class="bi bi-calendar-event"></i> Próximos Eventos
    </h4>
                </div>
     <div class="card-body">
   @if (upcoming != null && upcoming.Count > 0)
       {
         <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
  <thead class="table-light">
   <tr>
  <th><i class="bi bi-calendar-check"></i> Evento</th>
      <th><i class="bi bi-clock"></i> Fecha y Hora</th>
     <th><i class="bi bi-building"></i> Departamento</th>
         <th class="text-center" style="width: 120px;">Acción</th>
        </tr>
     </thead>
  <tbody>
    @foreach (var evt in upcoming.Take(10))
 {
     <tr>
   <td>
      <strong>@evt.Title</strong>
      @if (!string.IsNullOrEmpty(evt.Description))
    {
      <br />
  <small class="text-muted">@(evt.Description.Length > 50 ? evt.Description.Substring(0, 50) + "..." : evt.Description)</small>
          }
        </td>
  <td>
    <i class="bi bi-calendar3"></i> @evt.StartDate.ToString("dd/MM/yyyy")
<br />
       <small class="text-muted"><i class="bi bi-clock"></i> @evt.StartDate.ToString("HH:mm")</small>
       </td>
   <td>
      @if (evt.Department != null)
        {
<span class="badge bg-secondary">@evt.Department.Name</span>
}
       else
    {
    <span class="text-muted">-</span>
            }
   </td>
 <td class="text-center">
       <a asp-controller="Events" asp-action="Details" asp-route-id="@evt.Id" 
       class="btn btn-sm btn-outline-success">
            <i class="bi bi-eye"></i> Ver
              </a>
 </td>
          </tr>
      }
       </tbody>
              </table>
     </div>
          }
           else
      {
        <div class="alert alert-info mb-0">
          <i class="bi bi-info-circle"></i> No hay eventos próximos programados.
     <a asp-controller="Events" asp-action="Index" class="alert-link">Explorar eventos</a>
      </div>
}
    </div>
  @if (upcoming != null && upcoming.Count > 0)
            {
    <div class="card-footer bg-light text-end">
<a asp-controller="Events" asp-action="Index" class="btn btn-sm btn-success">
       <i class="bi bi-calendar-event"></i> Ver Todos los Eventos
     </a>
       </div>
      }
        </div>
   </div>
    </div>
</div>

<style>
    .card {
        transition: transform 0.2s, box-shadow 0.2s;
  }

    .card:hover {
    transform: translateY(-3px);
 box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
    }

    .list-group-item-action:hover {
        background-color: #f8f9fa;
        border-left: 3px solid #667eea;
    }

    .bg-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
</style>